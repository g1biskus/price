<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¶–µ–Ω—ã</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 10px 20px 80px 20px; 
            background-color: var(--tg-theme-bg-color, #f0f2f5);
            color: var(--tg-theme-text-color, #1c1c1e);
            margin: 0;
            transition: background-color 0.3s;
        }
        
        h1 {
            color: var(--tg-theme-text-color, #000);
            font-size: 1.8em;
            margin-bottom: 5px; 
            padding-bottom: 8px;
            border-bottom: 2px solid var(--tg-theme-hint-color, #d1d1d6);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –ú–µ–Ω—é */
        #menu_screen {
            padding-top: 20px;
        }

        .menu-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            
            /* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram */
            background-color: var(--tg-theme-secondary-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.15s, box-shadow 0.15s;
        }

        .menu-button:active {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
            background-color: var(--tg-theme-hint-color, #f0f0f0);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (Calculator screen) */
        #calculator_screen {
            display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 5px; 
            padding: 3px 0;
        }
        
        label {
            width: 50%; 
            min-width: 100px;
            flex-shrink: 0;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000);
            font-size: 0.95em;
        }
        
        input { 
            width: 50%;
            max-width: 180px; 
            padding: 10px 12px;
            box-sizing: border-box; 
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 10px;
            background-color: var(--tg-theme-secondary-bg-color, #f9f9f9);
            color: var(--tg-theme-text-color, #000);
            text-align: right;
            transition: border-color 0.2s;
            font-size: 16px; 
        }

        input:focus {
            border-color: var(--tg-theme-button-color, #007aff);
            outline: none;
        }

        #result_output { 
            font-size: 1em;
            margin-top: 5px; 
            padding: 12px 20px; 
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            white-space: pre-wrap;
            
            background-color: var(--tg-theme-button-color, #007aff);
            color: var(--tg-theme-button-text-color, #fff); 
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 2px 0; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }

        .result-name {
            font-weight: 500;
        }
        
        .result-price {
            font-weight: 700;
            min-width: 180px; 
            text-align: right; 
        }
    </style>
</head>
<body>
    
    <div id="menu_screen">
        <h1>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏</h1>
        
        <button class="menu-button" onclick="loadCalculator('–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä')">üîã –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä</button>
        <button class="menu-button" onclick="loadCalculator('–ù–∏–∂–Ω—è—è –ø–ª–∞—Ç–∞')">üîå –ù–∏–∂–Ω—è—è –ø–ª–∞—Ç–∞</button>
        <button class="menu-button" onclick="loadCalculator('–î–∏—Å–ø–ª–µ–π')">üñ•Ô∏è –î–∏—Å–ø–ª–µ–π</button>
        <button class="menu-button" onclick="loadCalculator('–û—Å—Ç–∞–ª—å–Ω–æ–µ')">üîß –û—Å—Ç–∞–ª—å–Ω–æ–µ</button>
    </div>

    <div id="calculator_screen">
        <h1 id="calculator_title">–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–î–∏—Å–ø–ª–µ–∏)</h1>

        <div class="input-group">
            <label for="input_copy">–ö–æ–ø–∏—è:</label>
            <input type="number" id="input_copy" placeholder="–¶–µ–Ω–∞ –∑–∞–ø—á–∞—Å—Ç–∏" step="1"> 
        </div>
        
        <div class="input-group">
            <label for="input_framed_copy">–ö–æ–ø–∏—è –≤ —Ä–∞–º–∫–µ:</label>
            <input type="number" id="input_framed_copy" placeholder="–¶–µ–Ω–∞ –∑–∞–ø—á–∞—Å—Ç–∏" step="1">
        </div>
        
        <div class="input-group">
            <label for="input_original">–û—Ä–∏–≥–∏–Ω–∞–ª:</label>
            <input type="number" id="input_original" placeholder="–¶–µ–Ω–∞ –∑–∞–ø—á–∞—Å—Ç–∏" step="1">
        </div>
        
        <div class="input-group">
            <label for="input_framed_original">–û—Ä–∏–≥–∏–Ω–∞–ª –≤ —Ä–∞–º–∫–µ:</label>
            <input type="number" id="input_framed_original" placeholder="–¶–µ–Ω–∞ –∑–∞–ø—á–∞—Å—Ç–∏" step="1">
        </div>
        
        <div id="result_output">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É.</div>
    </div>

    <script>
        // 1. –ö–û–ù–°–¢–ê–ù–¢–´ –î–õ–Ø –°–¢–ï–ü–ï–ù–ù–û–ô –ò–ù–¢–ï–†–ü–û–õ–Ø–¶–ò–ò Y (—Ç–æ–ª—å–∫–æ –¥–ª—è "–î–∏—Å–ø–ª–µ–∏")
        const X_MIN = 900;
        const X_MAX = 55000;
        const Y_MIN = 2000;
        const Y_MAX = 15000; 
        const P = 0.693;

        // 2. –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ Y (–°—Ç–µ–ø–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è)
        function calculateY(x) {
            if (x < X_MIN) return Y_MIN;
            if (x >= X_MAX) return Y_MAX; 
            
            const normalizedX = (x - X_MIN) / (X_MAX - X_MIN);
            const y = Y_MIN + (Y_MAX - Y_MIN) * Math.pow(normalizedX, P);
            
            return y;
        }

        // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        Telegram.WebApp.ready();
        
        const inputs = [
            { id: 'input_copy', name: '–ö–æ–ø–∏—è' },
            { id: 'input_framed_copy', name: '–ö–æ–ø–∏—è –≤ —Ä–∞–º–∫–µ' },
            { id: 'input_original', name: '–û—Ä–∏–≥–∏–Ω–∞–ª' },
            { id: 'input_framed_original', name: '–û—Ä–∏–≥–∏–Ω–∞–ª –≤ —Ä–∞–º–∫–µ' }
        ];

        let currentCategory = ''; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

        // 4. –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –†–ê–°–ß–ï–¢–ê (–ï–¥–∏–Ω–∞—è –§–æ—Ä–º—É–ª–∞ R –¥–ª—è –î–∏—Å–ø–ª–µ–µ–≤)
        function calculateSingle(x) {
            // –≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–î–∏—Å–ø–ª–µ–π"
            if (currentCategory !== '–î–∏—Å–ø–ª–µ–π') {
                return { r: '–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ' }; // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            }
            
            if (isNaN(x) || x <= 0) {
                return null;
            }
            
            // –®–∞–≥ 1: –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º Y –ø–æ —Ñ–æ—Ä–º—É–ª–µ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
            const y = calculateY(x);
            
            // –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω—è–µ–º –ï–î–ò–ù–£–Æ —Ñ–æ—Ä–º—É–ª—É R
            // R = X + 500 + (Y / 70 * 100)
            const result = x + 500 + (y / 70 * 100);
            
            // –®–∞–≥ 3: –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É
            const roundedResult = Math.ceil(result);
            
            return { r: roundedResult }; 
        }

        // 5. –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò
        function showScreen(screenId) {
            document.getElementById('menu_screen').style.display = 'none';
            document.getElementById('calculator_screen').style.display = 'none';
            document.getElementById(screenId).style.display = 'block';
        }
        
        function setupMainButton() {
             // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫—Ä—ã—Ç–∞ –∏–ª–∏ –∏–º–µ—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ "–ù–∞–∑–∞–¥"
             Telegram.WebApp.MainButton.hide(); 
             
             // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
             Telegram.WebApp.BackButton.onClick(showMenu);
             Telegram.WebApp.BackButton.hide();
        }

        function showMenu() {
            currentCategory = '';
            showScreen('menu_screen');
            Telegram.WebApp.BackButton.hide();
            Telegram.WebApp.MainButton.hide();
            document.getElementById('result_output').innerHTML = '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É.'; // –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        }

        function loadCalculator(category) {
            currentCategory = category;
            
            if (category === '–î–∏—Å–ø–ª–µ–π') {
                document.getElementById('calculator_title').textContent = `–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (${category})`;
                showScreen('calculator_screen');
                setupCalculatorButtons(); 
            } else {
                // –í—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                alert(`–õ–æ–≥–∏–∫–∞ –¥–ª—è "${category}" –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –í–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é.`);
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –∏ –û—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            Telegram.WebApp.BackButton.show();
            Telegram.WebApp.MainButton.show();
        }
        
        function setupCalculatorButtons() {
            // –ü–µ—Ä–µ–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ì–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
            Telegram.WebApp.MainButton.setText("–†–ê–°–°–ß–ò–¢–ê–¢–¨ –í–°–ï –¶–ï–ù–´");
            Telegram.WebApp.MainButton.setParams({ color: Telegram.WebApp.themeParams.button_color || '#007aff' }); 
            Telegram.WebApp.MainButton.onClick(calculateAll);
        }

        // 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setupMainButton();
        showMenu(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        
        
        /* 7. –§–£–ù–ö–¶–ò–ò –†–ê–°–ß–ï–¢–ê (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) */
        function setupInputListeners() {
            inputs.forEach((item, index) => {
                const inputElement = document.getElementById(item.id);
                inputElement.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' || e.keyCode === 13) {
                        e.preventDefault(); 
                        
                        const nextIndex = index + 1;
                        if (nextIndex < inputs.length) {
                            const nextInputId = inputs[nextIndex].id;
                            document.getElementById(nextInputId).focus();
                        } else {
                            calculateAll();
                            inputElement.blur(); 
                        }
                    }
                });
            });
        }
        
        setupInputListeners(); // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–µ–π –≤–≤–æ–¥–∞
        

        function calculateAll() {
            const resultOutput = document.getElementById('result_output');
            let output = '–ò—Ç–æ–≥–æ–≤—ã–µ –¶–µ–Ω—ã:';

            let resultHtml = ''; 
            let hasError = false;

            inputs.forEach(item => {
                const inputElement = document.getElementById(item.id);
                const x = parseFloat(inputElement.value) || 0; 
                
                const calculationResult = calculateSingle(x); 
                
                if (calculationResult === null) {
                    resultHtml += `<div class="result-item"><span class="result-name">${item.name}</span><span>–ü—Ä–æ–ø—É—â–µ–Ω–æ</span></div>`;
                } else if (calculationResult.r === '–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ') {
                    // –≠—Ç–æ –∑–∞–≥–ª—É—à–∫–∞, –µ—Å–ª–∏ –º—ã –≤–¥—Ä—É–≥ –ø–æ–ø–∞–ª–∏ —Å—é–¥–∞ –Ω–µ –∏–∑ "–î–∏—Å–ø–ª–µ–∏"
                     resultHtml += `<div class="result-item"><span class="result-name">${item.name}</span><span>–õ–æ–≥–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span></div>`;
                     hasError = true;
                } else {
                    resultHtml += `<div class="result-item"><span class="result-name">${item.name}</span><span class="result-price">${calculationResult.r}‚ÇΩ</span></div>`;
                }
            });

            resultOutput.innerHTML = `
                <div style="font-weight: 700; margin-bottom: 5px; border-bottom: none; padding-bottom: 0;">${output}</div>
                ${resultHtml}
            `;

            if (hasError) {
                 Telegram.WebApp.MainButton.setText("–û–®–ò–ë–ö–ê. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–æ–¥!");
                 Telegram.WebApp.MainButton.setParams({ color: '#ff3333' }); 
            } else {
                 Telegram.WebApp.MainButton.setText("–†–∞—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞.");
                 Telegram.WebApp.MainButton.setParams({ color: Telegram.WebApp.themeParams.button_color }); 
            }
        }
    </script>
</body>
</html>
